<!DOCTYPE html><html lang="en"><head>  <meta charset="UTF-8">  <meta name="viewport" content="width=device-width, initial-scale=1.0">  <title>RiverMeadow Diagram</title>  <style>    body, html { height: 100%; margin: 0; padding: 0; overflow: auto; font-family: Arial, sans-serif; }    .diagram-container { display: flex; flex-direction: column; height: 100vh; }    .header { background: white; padding: 10px 20px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center; z-index: 10; }    h1 { color: #0078d4; margin: 0; font-size: 18px; }    .content-area { flex: 1; padding: 20px; overflow: auto; background: white; display: flex; flex-direction: column; align-items: center; position: relative; }    #svg-container { max-width: 100%; transition: transform 0.3s; transform-origin: center top; margin: 0 auto; background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-radius: 4px; padding: 16px; position: relative; cursor: grab; pointer-events: all; }    #svg-container:active { cursor: grabbing; }    #svg-container svg { pointer-events: none; width: 100%; height: 100%; }    #svg-container svg * { pointer-events: none; }    svg { user-select: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; }    .actions { display: flex; gap: 10px; }    .button { background-color: #0078d4; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-size: 14px; text-decoration: none; display: inline-flex; align-items: center; }    .button:hover { background-color: #005a9e; }    .button-download { background-color: #28a745; }    .button-download:hover { background-color: #218838; }    .loading { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #666; background: rgba(255,255,255,0.9); padding: 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); z-index: 100; }    .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #0078d4; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 0 auto 15px; }    .hidden { display: none; }    .zoom-controls { position: fixed; bottom: 20px; right: 20px; background: white; border-radius: 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); display: flex; overflow: hidden; z-index: 100; }    .zoom-button { background: none; border: none; border-right: 1px solid #eee; padding: 8px 12px; cursor: pointer; font-size: 14px; }    .zoom-button:last-child { border-right: none; }    .zoom-button:hover { background: #f5f5f5; }    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }  </style></head><body>  <div class="diagram-container">    <div class="header">      <h1>RiverMeadow Migration Diagram</h1>      <div class="actions">        <a href="/api/download-full-diagram/diagram_1746533319082_a7e0df9d" download="rivermeadow_diagram.png" class="button button-download">Download PNG</a>        <a href="/api/diagram-xml/diagram_1746533319082_a7e0df9d.drawio" download="rivermeadow_diagram.drawio" class="button">Download Source</a>      </div>    </div>    <div class="content-area">      <div id="loading" class="loading">        <div class="spinner"></div>        <div>Loading diagram...</div>      </div>      <div id="svg-container"></div>    </div>    <div class="zoom-controls">      <button class="zoom-button" id="zoom-out">âˆ’</button>      <button class="zoom-button" id="zoom-reset">100%</button>      <button class="zoom-button" id="zoom-in">+</button>    </div>  </div>  <script>    const svgContainer = document.getElementById('svg-container');    const loading = document.getElementById('loading');    const zoomResetButton = document.getElementById('zoom-reset');    let currentZoom = 0.5;    try {      const savedZoom = localStorage.getItem('diagram_zoom_level');      if (savedZoom && !isNaN(parseFloat(savedZoom))) {        currentZoom = parseFloat(savedZoom);      }    } catch (e) {}    if (zoomResetButton) {      zoomResetButton.textContent = Math.round(currentZoom * 100) + '%';    }    fetch('/api/diagram-svg/diagram_1746533319082_a7e0df9d.drawio')      .then(response => {        if (!response.ok) throw new Error('Failed to load diagram');        return response.text();      })      .then(svgText => {        svgContainer.innerHTML = svgText;        loading.classList.add('hidden');        const svg = svgContainer.querySelector('svg');        if (svg) {          svg.style.maxWidth = '100%';          svg.style.height = 'auto';          svg.style.transformOrigin = 'center';        }        applyZoom();      })      .catch(error => {        console.error('Error loading SVG:', error);        loading.innerHTML = '<div style="color:red">Error loading diagram</div>';      });    document.getElementById('zoom-in').addEventListener('click', () => {      currentZoom = Math.min(2.5, currentZoom + 0.1);      applyZoom();    });    document.getElementById('zoom-out').addEventListener('click', () => {      currentZoom = Math.max(0.2, currentZoom - 0.1);      applyZoom();    });    document.getElementById('zoom-reset').addEventListener('click', () => {      currentZoom = 1.0;      applyZoom();    });    // Initialize drag functionality    let isDragging = false;    let startX, startY, initialOffsetX = 0, initialOffsetY = 0;        if (svgContainer) {      svgContainer.addEventListener('mousedown', (e) => {        // Only start dragging on primary button (usually left button)        if (e.button === 0) {          isDragging = true;          startX = e.clientX;          startY = e.clientY;          // Extract current transform values          const style = window.getComputedStyle(svgContainer);          const transform = style.transform || 'translate(0px, 0px) scale(1)';          const translateMatch = transform.match(/translate\(([-\d.]+)px,\s*([-\d.]+)px\)/);          if (translateMatch) {            initialOffsetX = parseFloat(translateMatch[1]) || 0;            initialOffsetY = parseFloat(translateMatch[2]) || 0;          } else {            initialOffsetX = 0;            initialOffsetY = 0;          }          e.preventDefault();        }      });    }        document.addEventListener('mousemove', (e) => {      if (isDragging) {        const dx = e.clientX - startX;        const dy = e.clientY - startY;        const newX = initialOffsetX + dx;        const newY = initialOffsetY + dy;        svgContainer.style.transform = 'translate(' + newX + 'px, ' + newY + 'px) scale(' + currentZoom + ')';      }    });        document.addEventListener('mouseup', () => {      isDragging = false;    });        document.addEventListener('mouseleave', () => {      isDragging = false;    });        function applyZoom() {      if (svgContainer) {        // Keep the transform position when changing zoom        const style = window.getComputedStyle(svgContainer);        const transform = style.transform || 'translate(0px, 0px) scale(1)';        const translateMatch = transform.match(/translate\(([-\d.]+)px,\s*([-\d.]+)px\)/);        const translateX = translateMatch ? parseFloat(translateMatch[1]) : 0;        const translateY = translateMatch ? parseFloat(translateMatch[2]) : 0;                svgContainer.style.transform = 'translate(' + translateX + 'px, ' + translateY + 'px) scale(' + currentZoom + ')';        const resetButton = document.getElementById('zoom-reset');        if (resetButton) {          resetButton.textContent = Math.round(currentZoom * 100) + '%';        }        try {          localStorage.setItem('diagram_zoom_level', currentZoom.toString());        } catch (e) {}      }    }  </script></body></html>